<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Technician Pay Sheet</title>
  <link rel="stylesheet" href="style.css"/>
  <script defer src="script.js"></script>
  <style>
    body { margin:0; font-family:Arial,sans-serif; background:#0B1F3A; color:#fff; overflow:hidden; }
    .animated-background { position:fixed; top:0; left:0; width:100%; height:100%; z-index:-1; }
    .animated-background img { width:100%; height:100%; object-fit:cover; opacity:0.1; }
    .top-bar { display:flex; justify-content:space-between; align-items:center; background:#384036; padding:1rem 2rem; position:fixed; top:0; width:100%; z-index:100; }
    .logo { height:50px; }
    #datetime { font-size:0.9rem; }
    main { display:flex; justify-content:center; align-items:flex-start; padding-top:100px; height:calc(100vh - 100px); }
    .card { background:#334232; padding:20px; border-radius:12px; width:600px; }
    .button { background:#E63946; border:none; padding:10px 15px; border-radius:8px; color:#fff; cursor:pointer; font-size:1rem; margin-right:10px; }
    label, input, select { display:block; width:100%; margin-bottom:10px; }
    input, select { padding:8px; border-radius:6px; border:none; background:#1f2a2f; color:#fff; }
    #results { margin-top:20px; }
    .actions { margin-top:20px; display:flex; justify-content:flex-end; }
  </style>
</head>
<body>
  <div class="animated-background">
    <img src="assets/circuit-background.png" alt="Circuit Background"/>
  </div>
  <div class="top-bar">
    <img src="assets/Cowboys_Logo.png" alt="Cowboys AC Logo" class="logo"/>
    <div id="datetime"></div>
  </div>
  <main>
    <div class="card">
      <h2>Technician Pay Sheet</h2>
      <form id="paySheetForm">
        <label for="employee">Employee Name</label>
        <input type="text" id="employee" name="employee" required />

        <label for="installPrice">Install Price</label>
        <input type="number" id="installPrice" name="installPrice" value="1000" required />

        <label for="permitCost">Permit Cost</label>
        <input type="number" id="permitCost" name="permitCost" value="100" required />

        <label for="paymentType">Payment Type</label>
        <select id="paymentType" name="paymentType">
          <option value="cash">Cash</option>
          <option value="credit">Credit Card</option>
          <option value="finance">Financing</option>
        </select>

        <label for="equipmentCost">Equipment Cost</label>
        <input type="number" id="equipmentCost" name="equipmentCost" required />

        <label for="supplyCost">Supply House Total Cost (Home Depot, Lowes, etc.)</label>
        <input type="number" id="supplyCost" name="supplyCost" required />

        <div class="actions">
          <button type="button" id="processButton" class="button">Process</button>
          <button type="button" id="pdfButton" class="button">Generate PDF</button>
        </div>
      </form>
      <div id="results"></div>
    </div>
  </main>
  <script>
    let lastCalc = {};
    function calculate() {
      const installPrice = parseFloat(document.getElementById('installPrice').value) || 0;
      const permitCost = parseFloat(document.getElementById('permitCost').value) || 0;
      const equipmentCost = parseFloat(document.getElementById('equipmentCost').value) || 0;
      const supplyCost = parseFloat(document.getElementById('supplyCost').value) || 0;
      const paymentType = document.getElementById('paymentType').value;
      const employee = document.getElementById('employee').value;

      const officeExpenses = 0.05 * installPrice;
      let paymentFee = 0;
      if (paymentType === 'credit') paymentFee = 0.033 * installPrice;
      else if (paymentType === 'finance') paymentFee = 0.08 * installPrice;

      const totalCosts = permitCost + equipmentCost + supplyCost + officeExpenses + paymentFee;
      const profit = installPrice - totalCosts;
      const profitMargin = (profit / installPrice) * 100;

      let commissionRate = 0.05;
      if (profitMargin >= 55) commissionRate = 0.10;
      else if (profitMargin >= 50) commissionRate = 0.08;

      const commission = installPrice * commissionRate;
      lastCalc = { employee, installPrice, totalCosts, profit, profitMargin, commission };

      document.getElementById('results').innerHTML = `
        <p><strong>Employee:</strong> ${employee}</p>
        <p><strong>Install Price:</strong> $${installPrice.toFixed(2)}</p>
        <p><strong>Total Costs:</strong> $${totalCosts.toFixed(2)}</p>
        <p><strong>Profit:</strong> $${profit.toFixed(2)}</p>
        <p><strong>Profit Margin:</strong> ${profitMargin.toFixed(2)}%</p>
        <p><strong>Commission (${(commissionRate*100).toFixed(0)}%):</strong> $${commission.toFixed(2)}</p>
      `;
    }

    function generatePDF() {
      const { employee, installPrice, totalCosts, profit, profitMargin, commission } = lastCalc;
      const doc = new window.jspdf.jsPDF();
      doc.text(
        `Technician Pay Sheet\n\n${employee}\nInstall: $${installPrice.toFixed(2)}\n` +
        `Total Costs: $${totalCosts.toFixed(2)}\nProfit: $${profit.toFixed(2)}\n` +
        `Margin: ${profitMargin.toFixed(2)}%\nCommission: $${commission.toFixed(2)}`,
        10,
        10
      );
      doc.save(`${employee.replace(/\s+/g, '_')}_pay_sheet.pdf`);
    }

    document.getElementById('processButton').addEventListener('click', calculate);
    document.getElementById('pdfButton').addEventListener('click', () => { calculate(); generatePDF(); });
    ['employee', 'installPrice', 'permitCost', 'equipmentCost', 'supplyCost', 'paymentType'].forEach(id => {
      const ev = id === 'paymentType' ? 'change' : 'input';
      document.getElementById(id).addEventListener(ev, calculate);
    });

    function updateDateTime() {
      const now = new Date();
      document.getElementById('datetime').textContent =
        now.toLocaleDateString(undefined, { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }) +
        ' ' + now.toLocaleTimeString();
    }
    setInterval(updateDateTime, 1000);
    updateDateTime();
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</body>
</html>
