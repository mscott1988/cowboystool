<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Technician Pay Sheet</title>
  <link rel="stylesheet" href="style.css"/>
  <script defer src="script.js"></script>
  <style>
    /* Inline styles kept minimal; global CSS handles most */
    .card { background:#334232; padding:20px; border-radius:12px; width:600px; margin:auto; }
    .button { background:#E63946; color:#fff; border:none; padding:10px 15px; border-radius:8px; cursor:pointer; margin-right:10px; }
    label,input,select { display:block; width:100%; margin-bottom:10px; }
    input,select { background:#1f2a2f; color:#fff; border:none; border-radius:6px; padding:8px; }
    #results p { margin:5px 0; }
    .actions { text-align:right; margin-top:20px; }
  </style>
</head>
<body>
  <!-- Circuit SVG background -->
  <div id="background-svg"></div>

  <!-- Top floating bar (identical to index.html) -->
  <div id="floating-bar">
    <div class="info-panels-left">
      <div id="installs-count">Installs Today: 0</div>
      <div id="current-datetime"></div>
    </div>
    <div class="info-panels-right">
      <div id="weather-info">Loading weather...</div>
    </div>
  </div>

  <!-- Centered, constrained logo with optional glow -->
  <div class="logo-container">
    <img src="assets/Cowboys_Logo.png" alt="Cowboys AC Logo" class="logo logo-glow" />
  </div>

  <!-- Main content container -->
  <main class="container">
    <h1 class="dashboard-title title-animated-from-left">Technician Pay Sheet</h1>
    <div class="dashboard-grid">
      <div class="card">
        <form id="paySheetForm">
          <label for="employee">Employee Name</label>
          <input type="text" id="employee" name="employee" required />

          <label for="installPrice">Install Price</label>
          <input type="number" id="installPrice" name="installPrice" value="1000" required />

          <label for="permitCost">Permit Cost</label>
          <input type="number" id="permitCost" name="permitCost" value="100" required />

          <label for="paymentType">Payment Type</label>
          <select id="paymentType" name="paymentType">
            <option value="cash">Cash</option>
            <option value="credit">Credit Card</option>
            <option value="finance">Financing</option>
          </select>

          <label for="equipmentCost">Equipment Cost</label>
          <input type="number" id="equipmentCost" name="equipmentCost" required />

          <label for="supplyCost">Supply House Total Cost (Home Depot, Lowes, etc.)</label>
          <input type="number" id="supplyCost" name="supplyCost" required />

          <div class="actions">
            <button type="button" id="processButton" class="button">Process</button>
            <button type="button" id="pdfButton" class="button">Generate PDF</button>
          </div>
        </form>
        <div id="results"></div>
      </div>
    </div>
  </main>

  <script>
    // Existing script.js functions handle floating bar, datetime, and weather.
    let lastCalc = {};
    function calculate() {
      const installPrice = +document.getElementById('installPrice').value || 0;
      const permitCost   = +document.getElementById('permitCost').value || 0;
      const equipmentCost= +document.getElementById('equipmentCost').value || 0;
      const supplyCost   = +document.getElementById('supplyCost').value || 0;
      const paymentType  = document.getElementById('paymentType').value;
      const employee     = document.getElementById('employee').value;
      const officeExpenses = 0.05 * installPrice;
      let paymentFee = 0;
      if (paymentType === 'credit') paymentFee = 0.033 * installPrice;
      else if (paymentType === 'finance') paymentFee = 0.08 * installPrice;
      const totalCosts = permitCost + equipmentCost + supplyCost + officeExpenses + paymentFee;
      const profit = installPrice - totalCosts;
      const profitMargin = (profit/installPrice)*100;
      let commissionRate = 0.05;
      if (profitMargin >= 55) commissionRate = 0.10;
      else if (profitMargin >= 50) commissionRate = 0.08;
      const commission = installPrice * commissionRate;
      lastCalc = {employee,installPrice,totalCosts,profit,profitMargin,commission};
      document.getElementById('results').innerHTML = `
        <p><strong>Employee:</strong> ${employee}</p>
        <p><strong>Install Price:</strong> $${installPrice.toFixed(2)}</p>
        <p><strong>Total Costs:</strong> $${totalCosts.toFixed(2)}</p>
        <p><strong>Profit:</strong> $${profit.toFixed(2)}</p>
        <p><strong>Profit Margin:</strong> ${profitMargin.toFixed(2)}%</p>
        <p><strong>Commission (${(commissionRate*100).toFixed(0)}%):</strong> $${commission.toFixed(2)}</p>
      `;
    }
    function generatePDF() {
      calculate();
      const {employee,installPrice,totalCosts,profit,profitMargin,commission} = lastCalc;
      const doc = new window.jspdf.jsPDF();
      doc.text(
        `Technician Pay Sheet\n\n${employee}\nInstall: $${installPrice.toFixed(2)}\n`+
        `Total Costs: $${totalCosts.toFixed(2)}\nProfit: $${profit.toFixed(2)}\n`+
        `Margin: ${profitMargin.toFixed(2)}%\nCommission: $${commission.toFixed(2)}`,
        10,10
      );
      doc.save(`${employee.replace(/\s+/g,'_')}_pay_sheet.pdf`);
    }
    document.getElementById('processButton').addEventListener('click', calculate);
    document.getElementById('pdfButton').addEventListener('click', generatePDF);
    ['employee','installPrice','permitCost','equipmentCost','supplyCost','paymentType'].forEach(id => {
      const e = (id==='paymentType'?'change':'input');
      document.getElementById(id).addEventListener(e, calculate);
    });
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</body>
</html>
