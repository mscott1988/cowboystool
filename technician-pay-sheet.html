<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Refrigerant Tracker â€“ Cowboys AC</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
<body>
  <!-- Circuit SVG background -->
  <div id="background-svg"></div>

  <!-- Top floating bar -->
  <div id="floating-bar">
    <div class="info-panels-left">
      <div id="installs-count">Installs Today: 0</div>
      <div id="current-datetime"></div>
    </div>
    <div class="info-panels-right">
      <div id="weather-info">Loading weather...</div>
    </div>
  </div>

  <!-- Centered, constrained logo with optional glow class -->
  <div class="logo-container">
    <img src="assets/cowboyslogo.png" alt="Cowboys AC Logo" class="logo logo-glow">
  </div>

      <h2>Technician Pay Sheet</h2>
      <form id="paySheetForm">
        <label for="employee">Employee Name</label>
        <input type="text" id="employee" name="employee" required>

        <label for="installPrice">Install Price</label>
        <input type="number" id="installPrice" name="installPrice" value="1000" required>

        <label for="permitCost">Permit Cost</label>
        <input type="number" id="permitCost" name="permitCost" value="100" required>

        <label for="paymentType">Payment Type</label>
        <select id="paymentType" name="paymentType">
          <option value="cash">Cash</option>
          <option value="credit">Credit Card</option>
          <option value="finance">Financing</option>
        </select>

        <label for="equipmentCost">Equipment Cost</label>
        <input type="number" id="equipmentCost" name="equipmentCost" required>

        <label for="otherCosts">Other Costs</label>
        <input type="number" id="otherCosts" name="otherCosts" required>

        <div style="margin-top:20px;">
          <button type="button" id="processButton" class="button">Process</button>
          <button type="button" id="pdfButton" class="button">Generate PDF</button>
        </div>
      </form>

      <div id="results"></div>
    </div>
  </main>

  <script>
    let lastCalc = {};
    function calculate() {
      const installPrice = +document.getElementById('installPrice').value || 0;
      const permitCost   = +document.getElementById('permitCost').value || 0;
      const equipmentCost= +document.getElementById('equipmentCost').value || 0;
      const otherCosts   = +document.getElementById('otherCosts').value || 0;
      const paymentType  = document.getElementById('paymentType').value;
      const employee     = document.getElementById('employee').value;

      const officeExpenses = 0.05 * installPrice;
      let paymentFee = 0;
      if (paymentType === 'credit')  paymentFee = 0.033 * installPrice;
      else if (paymentType === 'finance') paymentFee = 0.08 * installPrice;

      const totalCosts   = permitCost + equipmentCost + otherCosts + officeExpenses + paymentFee;
      const profit       = installPrice - totalCosts;
      const profitMargin = profit/installPrice*100;

      let commissionRate = 0.05;
      if (profitMargin >= 55) commissionRate = 0.10;
      else if (profitMargin >= 50) commissionRate = 0.08;

      const commission = installPrice * commissionRate;
      lastCalc = { employee, installPrice, totalCosts, profit, profitMargin, commission };

      document.getElementById('results').innerHTML = `
        <strong>Employee:</strong> ${employee}<br>
        <strong>Install Price:</strong> $${installPrice.toFixed(2)}<br>
        <strong>Total Costs:</strong> $${totalCosts.toFixed(2)}<br>
        <strong>Profit:</strong> $${profit.toFixed(2)}<br>
        <strong>Margin:</strong> ${profitMargin.toFixed(2)}%<br>
        <strong>Commission Rate:</strong> ${(commissionRate*100).toFixed(0)}%<br>
        <strong>Commission:</strong> $${commission.toFixed(2)}
      `;
    }

    function generatePDF() {
      const { employee, installPrice, totalCosts, profit, profitMargin, commission } = lastCalc;
      const doc = new window.jspdf.jsPDF();
      doc.text(
        `Technician Pay Sheet

${employee}
Install: $${installPrice.toFixed(2)}
`+
        `Total Costs: $${totalCosts.toFixed(2)}
Profit: $${profit.toFixed(2)}
`+
        `Margin: ${profitMargin.toFixed(2)}%
Commission: $${commission.toFixed(2)}`,
        10, 10
      );
      doc.save(`${employee.replace(/\s+/g,'_')}_pay_sheet.pdf`);
    }

    document.getElementById('processButton').addEventListener('click', calculate);
    document.getElementById('pdfButton').addEventListener('click', () => {
      calculate();
      generatePDF();
    });

    ['employee','installPrice','permitCost','equipmentCost','otherCosts','paymentType']
      .forEach(id => {
        const ev = id==='paymentType' ? 'change' : 'input';
        document.getElementById(id).addEventListener(ev, calculate);
      });

    function updateDateTime() {
      const now = new Date();
      document.getElementById('datetime').textContent =
        now.toLocaleDateString(undefined, { weekday:'long', year:'numeric', month:'long', day:'numeric' })
        + ' ' + now.toLocaleTimeString();
    }
    setInterval(updateDateTime, 1000);
    updateDateTime();
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</body>
</html>
