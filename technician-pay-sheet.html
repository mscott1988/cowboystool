<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Technician Pay Sheet</title>
  <link rel="stylesheet" href="style.css" />
  <script defer src="script.js"></script>
</head>
<body class="bg-circuit"> <!-- same background wrapper as refrigerant-tracker -->

  <!-- Top Bar (identical to refrigerant-tracker) -->
  <header class="top-bar">
    <img src="assets/Cowboys_Logo.png" alt="Cowboys AC Logo" class="logo" />
    <div id="datetime" class="datetime"></div>
  </header>

  <!-- Main Container -->
  <main class="container">
    <div class="card">
      <h1 class="page-title">Technician Pay Sheet</h1>

      <!-- Form laid out with the same grid classes -->
      <form id="paySheetForm" class="form-grid">

        <div class="form-group">
          <label for="employee">Employee Name</label>
          <input type="text" id="employee" name="employee" required />
        </div>

        <div class="form-group">
          <label for="installPrice">Install Price</label>
          <input type="number" id="installPrice" name="installPrice" value="1000" required />
        </div>

        <div class="form-group">
          <label for="permitCost">Permit Cost</label>
          <input type="number" id="permitCost" name="permitCost" value="100" required />
        </div>

        <div class="form-group">
          <label for="paymentType">Payment Type</label>
          <select id="paymentType" name="paymentType">
            <option value="cash">Cash</option>
            <option value="credit">Credit Card</option>
            <option value="finance">Financing</option>
          </select>
        </div>

        <div class="form-group">
          <label for="equipmentCost">Equipment Cost</label>
          <input type="number" id="equipmentCost" name="equipmentCost" required />
        </div>

        <div class="form-group">
          <label for="otherCosts">Other Costs</label>
          <input type="number" id="otherCosts" name="otherCosts" required />
        </div>

      </form>

      <!-- Action Buttons (same btn-primary / btn-secondary classes) -->
      <div class="form-actions">
        <button id="processButton" class="btn btn-primary">Process</button>
        <button id="pdfButton" class="btn btn-secondary">Generate PDF</button>
      </div>

      <!-- Results area -->
      <div id="results" class="results"></div>
    </div>
  </main>

  <script>
    // Live datetime (same as your other pages)
    function updateDateTime() {
      const now = new Date();
      document.getElementById('datetime').textContent =
        now.toLocaleDateString(undefined, { weekday:'long', year:'numeric', month:'long', day:'numeric' })
        + ' ' + now.toLocaleTimeString();
    }
    setInterval(updateDateTime, 1000);
    updateDateTime();

    // Calculation + Commission logic (identical to before)
    let lastCalc = {};
    function calculate() {
      const installPrice   = parseFloat(document.getElementById('installPrice').value) || 0;
      const permitCost     = parseFloat(document.getElementById('permitCost').value) || 0;
      const equipmentCost  = parseFloat(document.getElementById('equipmentCost').value) || 0;
      const otherCosts     = parseFloat(document.getElementById('otherCosts').value) || 0;
      const paymentType    = document.getElementById('paymentType').value;
      const employee       = document.getElementById('employee').value;

      const officeExpenses = 0.05 * installPrice;
      let paymentFee = 0;
      if (paymentType === 'credit') paymentFee = 0.033 * installPrice;
      else if (paymentType === 'finance') paymentFee = 0.08 * installPrice;

      const totalCosts   = permitCost + equipmentCost + otherCosts + officeExpenses + paymentFee;
      const profit       = installPrice - totalCosts;
      const profitMargin = (profit / installPrice) * 100;

      let commissionRate = 0.05;
      if (profitMargin >= 55) commissionRate = 0.10;
      else if (profitMargin >= 50) commissionRate = 0.08;

      const commission = installPrice * commissionRate;

      lastCalc = { employee, installPrice, totalCosts, profit, profitMargin, commission };

      document.getElementById('results').innerHTML = `
        <p><strong>Employee:</strong> ${employee}</p>
        <p><strong>Install Price:</strong> $${installPrice.toFixed(2)}</p>
        <p><strong>Total Costs:</strong> $${totalCosts.toFixed(2)}</p>
        <p><strong>Profit:</strong> $${profit.toFixed(2)}</p>
        <p><strong>Margin:</strong> ${profitMargin.toFixed(2)}%</p>
        <p><strong>Commission (${(commissionRate*100).toFixed(0)}%):</strong> $${commission.toFixed(2)}</p>
      `;
    }

    function generatePDF() {
      const { employee, installPrice, totalCosts, profit, profitMargin, commission } = lastCalc;
      const doc = new window.jspdf.jsPDF();
      doc.text(
        `Technician Pay Sheet\n\n${employee}\nInstall: $${installPrice.toFixed(2)}\n` +
        `Total Costs: $${totalCosts.toFixed(2)}\nProfit: $${profit.toFixed(2)}\n` +
        `Margin: ${profitMargin.toFixed(2)}%\nCommission: $${commission.toFixed(2)}`,
        10, 10
      );
      doc.save(`${employee.replace(/\s+/g,'_')}_pay_sheet.pdf`);
    }

    document.getElementById('processButton').addEventListener('click', calculate);
    document.getElementById('pdfButton').addEventListener('click', () => {
      calculate();
      generatePDF();
    });

    // Auto-recalc on field change
    ['installPrice','permitCost','equipmentCost','otherCosts','paymentType','employee'].forEach(id => {
      const ev = id==='paymentType' ? 'change' : 'input';
      document.getElementById(id).addEventListener(ev, calculate);
    });
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</body>
</html>
