<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Technician Pay Sheet</title>
  <link rel="stylesheet" href="style.css" />
  <script defer src="script.js"></script>
  <style>
    body { margin:0; font-family:Arial,sans-serif; background:#0B1F3A; color:#fff; overflow:hidden; }
    .animated-background { position:fixed; top:0; left:0; width:100%; height:100%; z-index:-1; }
    .animated-background img { width:100%; height:100%; object-fit:cover; opacity:0.1; }
    .top-bar { display:flex; justify-content:space-between; align-items:center; background:#384036; padding:1rem 2rem; position:fixed; top:0; width:100%; z-index:100; }
    .logo { height:50px; }
    #datetime { font-size:0.9rem; }
    main { display:flex; justify-content:center; align-items:flex-start; padding-top:100px; height:calc(100vh - 100px); }
    .card { background:#334232; padding:20px; border-radius:12px; width:600px; }
    .step-buttons { display:flex; justify-content:space-between; margin-bottom:20px; }
    .step-buttons button { flex:1; margin:0 5px; }
    .step { display:none; }
    .step.active { display:block; }
    .btn { padding:10px 15px; border:none; border-radius:6px; cursor:pointer; font-size:1rem; }
    .btn-primary { background:#E63946; color:#fff; }
    .btn-secondary { background:#384036; color:#fff; }
    label, input, select { display:block; width:100%; margin-bottom:10px; }
    input, select { padding:8px; border-radius:6px; border:none; background:#1f2a2f; color:#fff; }
    #results { margin-top:20px; }
  </style>
</head>
<body>
  <div class="animated-background">
    <img src="assets/circuit-background.png" alt="Circuit Background">
  </div>
  <div class="top-bar">
    <img src="assets/Cowboys_Logo.png" alt="Cowboys AC Logo" class="logo">
    <div id="datetime"></div>
  </div>
  <main>
    <div class="card">
      <h2>Technician Pay Sheet</h2>
      <div class="step-buttons">
        <button class="btn btn-secondary" id="btnStep1">Step 1</button>
        <button class="btn btn-secondary" id="btnStep2">Step 2</button>
        <button class="btn btn-secondary" id="btnStep3">Step 3</button>
      </div>
      <form id="paySheetForm">
        <div class="step" id="step1">
          <label for="employee">Employee Name</label>
          <input type="text" id="employee" name="employee" required>
          
          <label for="installPrice">Install Price</label>
          <input type="number" id="installPrice" name="installPrice" value="1000" required>

          <label for="permitCost">Permit Cost</label>
          <input type="number" id="permitCost" name="permitCost" value="100" required>
        </div>
        <div class="step" id="step2">
          <label for="paymentType">Payment Type</label>
          <select id="paymentType" name="paymentType">
            <option value="cash">Cash</option>
            <option value="credit">Credit Card</option>
            <option value="finance">Financing</option>
          </select>

          <label for="equipmentCost">Equipment Cost</label>
          <input type="number" id="equipmentCost" name="equipmentCost" required>

          <label for="supplyCost">Total cost from Supply houses/Vendors (Home Depot, Lowes, etc.)</label>
          <input type="number" id="supplyCost" name="supplyCost" required>
        </div>
        <div class="step" id="step3">
          <div style="display:flex; justify-content:space-between; align-items:center;">
            <button type="button" id="processButton" class="btn btn-primary">Process</button>
            <button type="button" id="pdfButton" class="btn btn-secondary">Generate PDF</button>
          </div>
          <div id="results"></div>
        </div>
      </form>
    </div>
  </main>
  <script>
    // Step navigation
    const steps = ['step1','step2','step3'];
    let current = 0;
    function showStep(index){
      steps.forEach((id,i)=>{
        document.getElementById(id).classList.toggle('active', i===index);
      });
    }
    document.getElementById('btnStep1').onclick = ()=>{ current=0; showStep(current); };
    document.getElementById('btnStep2').onclick = ()=>{ current=1; showStep(current); };
    document.getElementById('btnStep3').onclick = ()=>{ current=2; showStep(current); };
    showStep(0);

    // Calculation logic
    let lastCalc={};
    function calculate(){
      const installPrice = parseFloat(document.getElementById('installPrice').value)||0;
      const permitCost   = parseFloat(document.getElementById('permitCost').value)||0;
      const equipmentCost= parseFloat(document.getElementById('equipmentCost').value)||0;
      const supplyCost   = parseFloat(document.getElementById('supplyCost').value)||0;
      const paymentType  = document.getElementById('paymentType').value;
      const employee     = document.getElementById('employee').value;
      const officeExpenses=0.05*installPrice;
      let paymentFee=0;
      if(paymentType==='credit') paymentFee=0.033*installPrice;
      else if(paymentType==='finance') paymentFee=0.08*installPrice;
      const totalCosts=permitCost+equipmentCost+supplyCost+officeExpenses+paymentFee;
      const profit=installPrice-totalCosts;
      const profitMargin=(profit/installPrice)*100;
      let commissionRate=0.05;
      if(profitMargin>=55) commissionRate=0.10;
      else if(profitMargin>=50) commissionRate=0.08;
      const commission=installPrice*commissionRate;
      lastCalc={employee,installPrice,totalCosts,profit,profitMargin,commission};
      document.getElementById('results').innerHTML=`
        <p><strong>Employee:</strong> ${employee}</p>
        <p><strong>Install Price:</strong> $${installPrice.toFixed(2)}</p>
        <p><strong>Total Costs:</strong> $${totalCosts.toFixed(2)}</p>
        <p><strong>Profit:</strong> $${profit.toFixed(2)}</p>
        <p><strong>Margin:</strong> ${profitMargin.toFixed(2)}%</p>
        <p><strong>Commission (${(commissionRate*100).toFixed(0)}%):</strong> $${commission.toFixed(2)}</p>
      `;
    }
    function generatePDF(){
      const {employee,installPrice,totalCosts,profit,profitMargin,commission}=lastCalc;
      const doc=new window.jspdf.jsPDF();
      doc.text(
        `Technician Pay Sheet\n\n${employee}\nInstall: $${installPrice.toFixed(2)}\n`+
        `Total Costs: $${totalCosts.toFixed(2)}\nProfit: $${profit.toFixed(2)}\n`+
        `Margin: ${profitMargin.toFixed(2)}%\nCommission: $${commission.toFixed(2)}`,
        10,10
      );
      doc.save(`${employee.replace(/\s+/g,'_')}_pay_sheet.pdf`);
    }
    document.getElementById('processButton').addEventListener('click',calculate);
    document.getElementById('pdfButton').addEventListener('click',()=>{calculate();generatePDF();});
    // live datetime
    function updateDateTime(){
      const now=new Date();
      document.getElementById('datetime').textContent=
        now.toLocaleDateString(undefined,{weekday:'long',year:'numeric',month:'long',day:'numeric'})+' '+now.toLocaleTimeString();
    }
    setInterval(updateDateTime,1000);updateDateTime();
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</body>
</html>
